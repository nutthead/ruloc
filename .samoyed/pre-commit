#!/bin/sh
# Pre-commit hook for ruloc
# Runs fast code quality checks before allowing commits
#
# Bypass: SAMOYED=0 git commit
# Debug: SAMOYED=2 git commit

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if cargo is available
if ! command -v cargo >/dev/null 2>&1; then
    echo "âŒ Error: cargo not found in PATH"
    exit 1
fi

# 1. Format check
echo "  â”œâ”€ Checking code formatting..."
if ! cargo fmt --all -- --check; then
    echo "âŒ Format check failed!"
    echo "ğŸ’¡ Run: cargo fmt --all"
    exit 1
fi
echo "  â”‚  âœ“ Format check passed"

# 2. Clippy linting
echo "  â””â”€ Running clippy..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo "âŒ Clippy check failed!"
    echo "ğŸ’¡ Fix the warnings above or run: cargo clippy --fix"
    exit 1
fi
echo "     âœ“ Clippy passed"

echo "âœ… Pre-commit checks passed!"
exit 0
